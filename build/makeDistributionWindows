#!/bin/bash

#
# Modification History
#
# 2023-November-22   is52hertz
# Change to make X-Lives.
#
# 2007-November-12   Jason Rohrer
# Copied from Cultivation build.
#

source "variables-build.sh"

# if [ $# -lt 1 ] ; then
#    echo "Usage: $0 release_name"
#    exit 1
# fi


mkdir windows

rm -rf windows/${client_name}_${Client_v}


./makeBaseDistributionFolder

mv base/* windows


cd ../gameSource
if [ "$(uname)" = "Linux" ]; then
    sh makeRegenerateCaches
else
    sh makeRegenerateCachesWindows
fi

cd ../build/windows/${client_name}_${Client_v}

../../../gameSource/regenerateCaches

# don't ever include bin_cache in bundles, because they are large
# and change every update
rm */bin_*cache.fcz


cd ../..


cp ../gameSource/${client_name}.exe windows/${client_name}_${Client_v}/

cp win32/*.dll windows/${client_name}_${Client_v}/


g++ -o unix2dos unix2dos.c 
cp unix2dos windows
cp unix2dosScript windows


cd windows

d=`date`

echo "$1 built on $d" > ${client_name}_${Client_v}/binary.txt

for file in $( find ./${client_name}_${Client_v} -name "*.txt" )
do
	../unix2dosScript "$file"
done







# build a batch file for making a windows SFX bundle

echo "set version=${Client_v}" > makeWindowsExtractor_${Client_v}.bat; cat ../makeWindowsExtractor_template >> makeWindowsExtractor_${Client_v}.bat



